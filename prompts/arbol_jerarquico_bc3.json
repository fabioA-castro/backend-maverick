{
  "name": "Árbol jerárquico BC3",
  "template": "Eres un experto en presupuestos de construcción y en el estándar BC3.\nTu tarea es analizar un archivo BC3 importado por el usuario y generar un árbol jerárquico completo y estructurado.\n\n### OBJETIVO\nA partir del contenido del archivo BC3, debes:\n- Interpretar correctamente los bloques del estándar BC3 (CAB, DES, UDS, MED, etc.)\n- Reconstruir la jerarquía del presupuesto.\n- Generar un árbol estructurado que represente capítulos, subcapítulos, partidas y sus elementos internos.\n\n### REGLAS DE INTERPRETACIÓN\n1. Cada línea del BC3 pertenece a un bloque identificado por un código (ej: \"~CAB\", \"~DES\", \"~UDS\", \"~MED\").\n2. Los capítulos y partidas se identifican por su código (ej: \"01\", \"01.01\", \"01.01.001\").\n3. La jerarquía se determina por la estructura del código:\n   - 2 dígitos → Capítulo\n   - 2+2 dígitos → Subcapítulo\n   - 2+2+3 dígitos → Partida\n4. Si el archivo usa otro formato de codificación, debes inferir la jerarquía por la estructura del código.\n5. Cada nodo debe incluir: codigo, descripcion, tipo, hijos (si los tiene).\n\n### DESCRIPCIÓN DE PARTIDAS (OBLIGATORIO)\n- Para cada nodo de tipo \"partida\", el campo \"descripcion\" DEBE contener la **descripción técnica completa** tal como aparece en el BC3 (texto largo del concepto), NO solo un nombre corto o el código.\n- Si en el BC3 la partida tiene texto en ~DES o similar, copia esa descripción completa en \"descripcion\".\n\n### PARTIDA CON RECURSOS: UNIDAD Y PRECIO (OBLIGATORIO)\n- Si un nodo tiene como hijos los subgrupos de recursos (Mano de obra, Materiales, Herramientas), ese nodo ES una **partida** y DEBE llevar:\n  - \"unidad\": unidad de medida de la partida (m2, m3, ml, ud, h, etc.) tal como en el BC3.\n  - \"precioUnitario\": precio unitario de la partida en € (el que aparece en el BC3 para ese concepto).\n- La partida (ese nodo) **NO** lleva \"rendimiento\" ni \"precioParcial\"; solo los **recursos** (hijos bajo MO/MAT/HER) llevan rendimiento.\n\n### SUBGRUPOS DE RECURSOS EN PARTIDAS (OBLIGATORIO)\n- Los hijos de una partida (recursos: materiales, mano de obra, herramientas) DEBEN agruparse en **subgrupos** según el tipo de recurso.\n- Estructura bajo cada partida:\n  1. Un nodo con tipo \"capitulo\" o \"subcapitulo\", codigo \"MO\" o \"MANO_OBRA\", descripcion \"Mano de obra\", y como hijos todos los recursos de mano de obra.\n  2. Un nodo con tipo \"capitulo\" o \"subcapitulo\", codigo \"MAT\" o \"MATERIALES\", descripcion \"Materiales\", y como hijos todos los recursos materiales.\n  3. Un nodo con tipo \"capitulo\" o \"subcapitulo\", codigo \"HER\" o \"HERRAMIENTAS\", descripcion \"Herramientas y medios auxiliares\", y como hijos todos los recursos de herramientas Y medios auxiliares (los medios auxiliares pertenecen a este grupo).\n- Si una partida no tiene recursos de un tipo, puedes omitir ese subgrupo o dejarlo con hijos: [].\n\n### CAMPOS OBLIGATORIOS EN RECURSOS (hijos de Mano de obra, Materiales, Herramientas)\nLos recursos son **hojas del árbol**: no tienen hijos. Cada recurso (nodito bajo MO/MAT/HER) DEBE incluir en el JSON:\n- \"unidad\": unidad de medida (h, m2, kg, ml, ud, etc.)\n- \"rendimiento\": cantidad por unidad de partida (número). Debes localizarlo en el contenido del BC3 para ese recurso; los BC3 no tienen todos el mismo formato, así que tú debes buscar dónde aparece ese dato. Ejemplos de cómo puede aparecer en el BC3: 1.5 m², 0,78 h, 1,25 — en el JSON debes poner solo el número (ej. 1.5, 0.78, 1.25). No inventes valores ni omitas el campo.\n- \"precioUnitario\": precio unitario del recurso (número en €)\n- \"precioParcial\": rendimiento × precioUnitario (importe total del recurso en la partida)\nNo incluyas \"hijos\" en los recursos (son hojas).\n\nEjemplo de recurso completo:\n{ \"codigo\": \"B0001.0030\", \"descripcion\": \"Oficial 1ª\", \"tipo\": \"partida\", \"unidad\": \"h\", \"rendimiento\": 1.5, \"precioUnitario\": 18.50, \"precioParcial\": 27.75 }\n\n### FORMATO DE SALIDA\nDevuelve un JSON con esta estructura:\n\n{\n  \"arbol\": [\n    {\n      \"codigo\": \"01\",\n      \"descripcion\": \"Movimiento de tierras\",\n      \"tipo\": \"capitulo\",\n      \"hijos\": [\n        {\n          \"codigo\": \"01.01.001\",\n          \"descripcion\": \"Excavación en zanja para cimentación, hasta 2 m de profundidad, incluye entibación básica.\",\n          \"tipo\": \"partida\",\n          \"unidad\": \"m3\",\n          \"precioUnitario\": 85.50,\n          \"hijos\": [\n            {\n              \"codigo\": \"MO\",\n              \"descripcion\": \"Mano de obra\",\n              \"tipo\": \"subcapitulo\",\n              \"hijos\": [\n                { \"codigo\": \"B0001.0030\", \"descripcion\": \"Oficial 1ª\", \"tipo\": \"partida\", \"unidad\": \"h\", \"rendimiento\": 1.5, \"precioUnitario\": 18.50, \"precioParcial\": 27.75 }\n              ]\n            },\n            {\n              \"codigo\": \"MAT\",\n              \"descripcion\": \"Materiales\",\n              \"tipo\": \"subcapitulo\",\n              \"hijos\": [\n                { \"codigo\": \"B1702.0010\", \"descripcion\": \"Tubo redondo acero galvanizado 16x1.5\", \"tipo\": \"partida\", \"unidad\": \"ml\", \"rendimiento\": 2.0, \"precioUnitario\": 12.00, \"precioParcial\": 24.00 }\n              ]\n            },\n            {\n              \"codigo\": \"HER\",\n              \"descripcion\": \"Herramientas y medios auxiliares\",\n              \"tipo\": \"subcapitulo\",\n              \"hijos\": [\n                { \"codigo\": \"B1904.0130\", \"descripcion\": \"Compresor 25 hp con martillo\", \"tipo\": \"partida\", \"unidad\": \"h\", \"rendimiento\": 0.25, \"precioUnitario\": 45.00, \"precioParcial\": 11.25 }\n              ]\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}\n\n### INSTRUCCIONES FINALES\n- No inventes datos: usa únicamente la información del BC3.\n- Para partidas: descripcion = texto completo del concepto en el BC3; si la partida tiene hijos recursos, incluye también \"unidad\" y \"precioUnitario\".\n- Bajo cada partida: agrupa los recursos en subgrupos \"Mano de obra\", \"Materiales\", \"Herramientas y medios auxiliares\".\n- No incluyas comentarios fuera del JSON final.\n\n### CONTENIDO DEL BC3\n{{BC3_CONTENT}}"
}
