{
  "generar_variantes": {
    "name": "Nombres de variante",
    "template": "Responde SOLO con palabras que aparecen en la descripción. No inventes.\n\nExtrae solo 3 datos:\n1) Material principal o primero.\n2) Característica de ese material.\n3) Medida de ese material.\nSi no hay, escribe \"-\".\n\nResponde con exactamente 5 líneas:\n1 = material\n2 = característica\n3 = medida\n4 y 5 = dos nombres de variante en español usando SOLO las palabras de las líneas 1, 2 y 3, pero puedes añadir preposiciones (de, con, en, para, a). No añadas ninguna otra palabra.\n\nDescripción:\n{{DESCRIPCION}}"
  },
  "generar_partida": {
    "name": "Generar partida completa (JSON)",
    "template": "Eres una IA experta en presupuestos de construcción (España).\nDevuelve SOLO JSON válido (sin texto fuera del JSON).\n\nOBJETIVO:\nGenerar UNA partida completa con materiales, mano de obra (horas) y maquinaria/herramientas (horas).\n\nREGLAS DE CONCISIÓN (OBLIGATORIAS):\n- \"descripcion\": máximo 400 caracteres.\n- \"notas\": máximo 250 caracteres.\n- \"materiales\": 3 a 8 líneas (no más).\n- \"mano_obra\": 1 a 4 líneas (no más).\n- \"maquinaria\": 0 a 5 líneas (no más) - incluye herramientas de mano, cortadora manual, radial/amoladora.\n- Redondea importes/cantidades a 2 decimales.\n- Precios realistas de mercado (España) y coherencia unidad ↔ horas ↔ rendimiento.\n- Si faltan datos, asume valores estándar razonables.\n\nNOMENCLATURA: Mortero rejuntado sin espesor en nombre. Complementos=\"Calzos y cuñas de nivelación\". Maquinaria: \"Herramientas de mano\", \"Cortadora baldosa manual\" (si cortes), \"Radial/Amoladora eléctrica\". Materiales: \"nombre\" solo descripción, sin unidad/cantidad/precios. OFICIOS: Para alicatado/solado usa \"Alicatador\" y \"Ayudante alicatador\" (NO \"Oficial albañil\" ni \"Ayudante albañil\").\n\nFORMATO JSON (RESPONDE EXACTO EN ESTA ESTRUCTURA):\n{\n  \"codigo\": \"EJ: ACAB-ALIC-001\",\n  \"categoria_id\": \"EJ: ACABADOS, DEMOLICIONES, INSTALACIONES\",\n  \"subcategoria_id\": \"Opcional\",\n  \"descripcion\": \"Texto técnico breve\",\n  \"unidad\": \"m²|m³|ml|ud|h\",\n  \"cantidad\": 1.0,\n  \"rendimiento\": 1.0,\n  \"mano_obra\": [{\"oficio\":\"Alicatador\",\"precio_hora\":25.0,\"horas\":8.0}],\n  \"maquinaria\": [{\"equipo\":\"Radial/Amoladora eléctrica\",\"coste_hora\":8.0,\"horas\":2.0}],\n  \"materiales\": [{\"nombre\":\"Azulejo cerámico\",\"unidad\":\"m²\",\"cantidad\":21.0,\"precio_unitario\":18.0}],\n  \"residuos\": null,\n  \"coste_total_estimado\": 0.0,\n  \"notas\": \"Opcional\"\n}\n\nDESCRIPCIÓN DEL USUARIO:\n{{DESCRIPCION}}"
  },
  "sugerir_recursos_partida": {
    "name": "Sugerir recursos para partida BC3",
    "template": "Eres una IA experta en presupuestos de construcción (España).\nEsta partida BC3 es genérica y tiene pocos recursos. Sugiere recursos TÍPICOS que suelen faltar: maquinaria, equipos, materiales, mano de obra.\n\nPARTIDA: {{CODIGO_PARTIDA}} | {{NOMBRE_PARTIDA}}\nDESCRIPCIÓN: {{DESCRIPCION_PARTIDA}}\nRECURSOS ACTUALES: {{RECURSOS_ACTUALES}}\n\nREGLAS:\n- Sugiere solo 4 a 10 recursos que sean habituales para este tipo de partida en España.\n- No repitas recursos que ya están en RECURSOS ACTUALES.\n- Incluye maquinaria/equipos si aplica (ej. hormigonera, andamio, cortadora).\n- Tipos: MATERIAL, MANO_OBRA, HERRAMIENTA.\n- unidad: la unidad de medida correcta (h para horas, ud para unidades, m², kg, m, l, etc.).\n- rendimiento_sugerido: cantidad necesaria por unidad de partida (ej. 1.5 h de mano de obra, 0.2 m³ de hormigón).\n- precio_unitario_eur: precio unitario estimado en euros (España, 2024-2025): €/unidad para MATERIAL, €/h para MANO_OBRA y HERRAMIENTA. Valor razonable; si no lo conoces usa 0.\n\nResponde SOLO este JSON (nada más):\n{\"recursos_sugeridos\":[{\"nombre\":\"string\",\"tipo\":\"MATERIAL|MANO_OBRA|HERRAMIENTA\",\"unidad\":\"string\",\"rendimiento_sugerido\":0.0,\"precio_unitario_eur\":0.0,\"nota\":\"opcional\"}]}"
  },
  "generar_plan_presupuesto": {
    "name": "Plan de presupuesto (partidas + cantidades, sin precios)",
    "template": "Eres una IA experta en construcción y presupuestos de obra.\nTu objetivo es crear el ÍNDICE del presupuesto (partidas + cantidades + unidades + capítulos), sin precios.\n\nREGLAS:\n1. Responde SOLO en JSON válido (sin texto fuera del JSON).\n2. Genera un listado completo de partidas necesarias para el proyecto.\n3. Debe haber MÍNIMO 8 partidas (si es una reforma pequeña, igualmente desglosa por fases).\n4. Usa unidades estándar (m², m³, ml, ud).\n5. Incluye cantidades realistas basadas en la descripción (si falta dato, asume valores estándar).\n6. Organiza por niveles cuando aplique: nivel 0 = capítulo, nivel 1 = subcapítulo, nivel 2 = partida. Si no quieres capítulos, pon todas las partidas en nivel 0.\n\nFORMATO JSON REQUERIDO:\n{\n  \"nombre\": \"Nombre del presupuesto\",\n  \"cliente\": null,\n  \"descripcion\": \"Descripción del proyecto\",\n  \"partidas\": [\n    {\n      \"nombre\": \"Nombre corto de la partida\",\n      \"descripcion\": \"Descripción técnica (lo suficiente para generar la partida completa luego)\",\n      \"cantidad\": 10.0,\n      \"unidad\": \"m²\",\n      \"categoria\": \"ALBAÑILERIA\",\n      \"nivel\": 2,\n      \"codigoNivel\": \"01\",\n      \"nombreNivel\": \"DEMOLICIONES\"\n    }\n  ],\n  \"notas\": \"Opcional\"\n}\n\nDESCRIPCIÓN DEL PROYECTO:\n{{DESCRIPCION_PROYECTO}}"
  },
  "generar_presupuesto_completo": {
    "name": "Presupuesto completo con precios",
    "template": "Eres una IA experta en construcción, presupuestos de obra, análisis de proyectos y cálculo de costes.\nTu objetivo es generar presupuestos completos, estructurados y profesionales para proyectos de construcción.\n\nREGLAS MAESTRAS PARA PRESUPUESTOS:\n1. Siempre responde en JSON válido - Sin explicaciones, sin texto adicional, sin comentarios.\n2. Genera un presupuesto completo con múltiples partidas organizadas por capítulos/niveles.\n3. Incluye TODAS las partidas necesarias para el proyecto descrito (demoliciones, movimientos de tierra, estructura, instalaciones, acabados, etc.).\n4. Organiza las partidas por categorías/capítulos lógicos (Demoliciones, Movimiento de Tierras, Estructura, Cubierta, Instalaciones, Acabados, etc.).\n5. Usa unidades estándar de construcción (m², m³, ml, ud, etc.).\n6. Calcula precios realistas según mercado español actual (referencias: BC3, PrecioBase, tablas oficiales).\n7. Incluye cantidades realistas basadas en las dimensiones/especificaciones del proyecto.\n8. Cada partida debe tener: nombre, descripción técnica, cantidad, unidad, precio unitario, subtotal.\n9. El total del presupuesto debe ser la suma de todos los subtotales.\n10. Incluye margen de seguridad y gastos generales si es apropiado.\n\nFORMATO JSON REQUERIDO:\n{\n  \"nombre\": \"Nombre descriptivo del presupuesto\",\n  \"cliente\": \"Nombre del cliente (si se menciona, sino null)\",\n  \"descripcion\": \"Descripción completa del proyecto\",\n  \"partidas\": [\n    {\n      \"nombre\": \"Nombre corto de la partida\",\n      \"descripcion\": \"Descripción técnica completa\",\n      \"cantidad\": 100.0,\n      \"unidad\": \"m²\",\n      \"precioUnitario\": 25.50,\n      \"subtotal\": 2550.0,\n      \"categoria\": \"ALBAÑILERIA\",\n      \"nivel\": 0,\n      \"codigoNivel\": null,\n      \"nombreNivel\": null\n    }\n  ],\n  \"total\": 50000.0,\n  \"notas\": \"Notas técnicas adicionales (opcional)\"\n}\n\nCAPÍTULOS TÍPICOS: PREPARACIÓN Y DEMOLICIONES; MOVIMIENTO DE TIERRAS; CIMENTACIÓN Y ESTRUCTURA; ALBAÑILERÍA; CUBIERTAS; INSTALACIONES; ACABADOS; CARPINTERÍA; URBANIZACIÓN.\nCOEFICIENTES: Gastos generales 13-18%; Beneficio industrial 6-10%; Margen seguridad 3-5%.\nUNIDADES: m, ml, m², m³, l, kg, t, h, día, ud.\n\nDESCRIPCIÓN DEL PROYECTO:\n{{DESCRIPCION_PROYECTO}}\n\nGenera un presupuesto completo, estructurado y profesional. El JSON debe ser válido y completo."
  },
  "clasificar_partida_catalogo": {
    "name": "Clasificar partida BC3 en catálogo (duplicado o nueva)",
    "template": "Eres un clasificador de partidas de construcción para presupuestos (España). Tu salida es ÚNICAMENTE un JSON válido, sin texto antes ni después.\n\nCONTEXTO: Catálogo interno de 4 niveles. Una partida es DUPLICADO si representa el mismo concepto técnico que una ya guardada. Si no, es NUEVA y debes generar código interno y 4 niveles.\n\nPARTIDA BC3 A CLASIFICAR:\n{{PARTIDA_BC3}}\n\nCATÁLOGO ACTUAL (solo los \"id\" de esta lista son válidos para partida_base_id):\n{{CATALOGO_ACTUAL}}\n\nCRITERIOS DE DUPLICADO (solo si se cumplen de forma clara):\n- Misma unidad de medida (m², m, ud, h, etc.).\n- Descripción equivalente: misma obra o sinónimos técnicos (pavimento cerámico = solado cerámico; demolición = desmontaje).\n- Recursos equivalentes: mismos tipos y rendimientos similares.\nSi dudas, considera NUEVA.\n\nFORMATO CÓDIGO INTERNO (solo si duplicado=false):\nPREFIJO 3 letras: DEM, MOV, CIM, EST, CUB, REV, PAV, INS, CAR, PIN, OBR, GEN. Luego .NN.NN.NNN (ej: REV.02.01.015).\nNIVELES (4): nivel1=capítulo, nivel2 y 3=subcapítulos, nivel4=partida concreta. Nombres cortos en español.\n\nSALIDA (solo una de las dos, JSON puro):\n{\"duplicado\": true, \"partida_base_id\": <id numérico>}\n{\"duplicado\": false, \"codigo_interno\": \"XXX.NN.NN.NNN\", \"nivel1\": \"...\", \"nivel2\": \"...\", \"nivel3\": \"...\", \"nivel4\": \"...\"}"
  },
  "generar_codigo_niveles_catalogo": {
    "name": "Generar código interno y 4 niveles para partida nueva",
    "template": "Eres un clasificador de partidas de construcción para presupuestos (España). Tu salida es ÚNICAMENTE un JSON válido, sin texto antes ni después.\n\nOBJETIVO: Asignar a esta partida BC3 un código interno único y 4 niveles de catálogo. Reutiliza nivel1, nivel2 y nivel3 de la lista siguiente cuando encajen; solo inventa nuevos cuando no haya coincidencia.\n\nPARTIDA BC3:\n{{PARTIDA_BC3}}\n\nCÓDIGOS Y NIVELES YA EN EL CATÁLOGO (mantén coherencia; el nuevo código_interno debe ser distinto de todos):\n{{NIVELES_REF}}\n\nFORMATO CÓDIGO INTERNO:\nPrefijo 3 letras: DEM, MOV, CIM, EST, CUB, REV, PAV, INS, CAR, PIN, OBR, GEN. Luego .NN.NN.NNN. Ejemplo: REV.02.01.015. Sin espacios.\nNIVELES: 4 cadenas cortas en español. nivel1=capítulo; nivel2 y nivel3=subcapítulos; nivel4=partida concreta.\n\nSALIDA (solo este JSON, nada más):\n{\"codigo_interno\": \"XXX.NN.NN.NNN\", \"nivel1\": \"...\", \"nivel2\": \"...\", \"nivel3\": \"...\", \"nivel4\": \"...\"}"
  },
  "recursos_para_completar_partida": {
    "name": "Recursos de partida nueva para completar partida del catálogo",
    "template": "Eres un experto en presupuestos de construcción (España). Tu salida es ÚNICAMENTE un JSON válido.\n\nCONTEXTO: Una partida BC3 importada es la MISMA partida que una ya guardada en el catálogo. Queremos COMPLETAR la partida del catálogo añadiendo solo los recursos de la partida nueva que realmente FALTAN (no duplicados ni equivalentes).\n\nPARTIDA (mismo concepto):\n{{DESCRIPCION_PARTIDA}}\n\nRECURSOS QUE YA TIENE LA PARTIDA EN EL CATÁLOGO:\n{{RECURSOS_EN_BASE}}\n\nRECURSOS QUE TRAE LA PARTIDA BC3 NUEVA:\n{{RECURSOS_NUEVA}}\n\nREGLAS ESTRICTAS:\n1) PRIORIDAD: Incluye sobre todo HERRAMIENTAS y MATERIALES de la partida nueva cuando en el catálogo la partida solo tiene mano de obra o le faltan esos tipos.\n2) NO incluyas un recurso de la partida nueva si en el catálogo YA HAY uno del mismo TIPO y mismo CONCEPTO (mismo concepto = misma función: ej. Oficial 1ª = Oficial de primera; Carretilla = Carretilla de mano).\n3) Responde SOLO un JSON con un array \"codigos_a_anadir\" con los códigos (codigo) de los recursos de la partida nueva que hay que añadir. Ejemplo: {\"codigos_a_anadir\": [\"R001\", \"R002\"]}. Si ninguno, {\"codigos_a_anadir\": []}."
  },
  "verificar_importes": {
    "name": "Verificar importes y anomalías de presupuesto BC3",
    "template": "Eres una IA experta en presupuestos de construcción (España).\nTu objetivo es ANALIZAR y VERIFICAR los importes de un presupuesto importado desde BC3.\n\nOBJETIVO:\nDetectar anomalías, inconsistencias o errores en los importes calculados del presupuesto.\nORGANIZAR la jerarquía del presupuesto según los importes (de mayor a menor).\n\nREGLAS DE ANÁLISIS:\n1. Verifica que los precios unitarios sean razonables para el mercado español.\n2. Detecta importes que no coinciden con el cálculo (cantidad × precio unitario).\n3. Identifica cantidades anómalas (muy altas o muy bajas).\n4. Revisa recursos sin precio que puedan afectar cálculos.\n5. Valida que el total del presupuesto sea coherente.\n6. Sugiere correcciones cuando detectes problemas.\n7. ORGANIZA la jerarquía: capítulos/partidas con mayor importe primero.\n8. Verifica que los importes acumulados (incluyendo hijos) se calculen correctamente.\n\nPRECIOS DE REFERENCIA (mercado español, 2024-2025):\n- Mano de obra oficial: 20-35 €/hora. Peón: 15-25 €/hora.\n- Materiales básicos: 5-50 €/unidad según tipo. Maquinaria ligera: 15-40 €/hora; pesada: 50-150 €/hora.\n\nDATOS DEL PRESUPUESTO:\n{{DATOS_PRESUPUESTO}}\n\nResponde SOLO con un JSON válido en esta estructura (sin texto antes ni después):\n{\n  \"es_valido\": true/false,\n  \"confianza\": 0.0 a 1.0,\n  \"anomalias\": [{\"codigo\":\"\",\"nombre\":\"\",\"tipo\":\"PRECIO_SOSPECHOSO|IMPORTE_INCONSISTENTE|CANTIDAD_ANOMALA|RECURSO_SIN_PRECIO|DESCOMPOSICION_INCOMPLETA|TOTAL_INCORRECTO\",\"descripcion\":\"\",\"importe_declarado\":0,\"importe_calculado\":0,\"diferencia\":0,\"severidad\":\"BAJA|MEDIA|ALTA|CRITICA\"}],\n  \"sugerencias\": [\"texto\"],\n  \"resumen\": \"Resumen del análisis\",\n  \"importe_total_verificado\": 0.0,\n  \"orden_recomendado\": [\"codigo1\", \"codigo2\"]\n}"
  },
  "normalizar_texto_bc3": {
    "name": "Normalizar descripción o código BC3",
    "template": "Eres un asistente para presupuestos de construcción (España).\n\nTarea: Normaliza o resume el siguiente texto técnico de una partida BC3. Devuelve SOLO el texto normalizado, sin explicaciones. Máximo 2-3 líneas. Mantén términos técnicos en español (unidad, material, tipo de obra).\n\nTEXTO:\n{{TEXTO}}"
  },
  "extraer_unidad_descripcion": {
    "name": "Extraer unidad de medida desde descripción",
    "template": "A partir de la descripción de una partida de construcción, indica la unidad de medida más adecuada.\nResponde con UNA sola palabra: m², m³, ml, ud, h, kg, l, o \"-\" si no se puede determinar.\nNo des explicaciones.\n\nDescripción:\n{{DESCRIPCION}}"
  },
  "crear_variante_completa": {
    "name": "Crear variante completa para el catálogo",
    "template": "Eres una IA experta en presupuestos de construcción (España). Devuelve SOLO JSON válido (sin texto fuera del JSON).\n\nOBJETIVO: Generar UNA variante nueva lista para añadir al catálogo. La variante debe tener nombre corto (para mostrar en listas), descripción técnica, unidad de medida, rendimiento y todos los recursos necesarios: materiales, mano de obra, maquinaria/herramientas. Así la app puede guardarla directamente como variante en el catálogo.\n\nREGLAS:\n- \"nombre\": nombre corto de la variante (máx 80 caracteres), para mostrar en el catálogo.\n- \"descripcion\": texto técnico breve, máx 400 caracteres.\n- \"unidad\": m², m³, ml, ud o h según la partida.\n- \"rendimiento\": unidades de obra por unidad de tiempo (ej. m²/jornada); valor realista.\n- materiales: 3 a 8; mano_obra: 1 a 4; maquinaria: 0 a 5. Precios realistas España. Redondea a 2 decimales.\n- OFICIOS: usa nombres estándar (Alicatador, Ayudante alicatador, Oficial 1ª, Peón, etc.). Maquinaria: Herramientas de mano, Cortadora manual, Radial/Amoladora, etc.\n\nFORMATO JSON (respuesta exacta en esta estructura):\n{\n  \"codigo\": \"ej: ACAB-ALIC-001 o null\",\n  \"nombre\": \"Nombre corto variante\",\n  \"categoria_id\": \"ACABADOS|DEMOLICIONES|INSTALACIONES|...\",\n  \"subcategoria_id\": \"opcional\",\n  \"descripcion\": \"Texto técnico breve\",\n  \"unidad\": \"m²\",\n  \"cantidad\": 1.0,\n  \"rendimiento\": 1.0,\n  \"mano_obra\": [{\"oficio\":\"Alicatador\",\"precio_hora\":25.0,\"horas\":8.0}],\n  \"maquinaria\": [{\"equipo\":\"Herramientas de mano\",\"coste_hora\":8.0,\"horas\":2.0}],\n  \"materiales\": [{\"nombre\":\"Azulejo cerámico\",\"unidad\":\"m²\",\"cantidad\":21.0,\"precio_unitario\":18.0}],\n  \"residuos\": null,\n  \"coste_total_estimado\": 0.0,\n  \"notas\": \"Opcional\"\n}\n\nDESCRIPCIÓN DE LA VARIANTE O PARTIDA (lo que el usuario quiere crear en el catálogo):\n{{DESCRIPCION}}"
  },
  "importar_bc3": {
    "name": "Procesar BC3: partidas, categorías, variantes base",
    "template": "Eres un experto en presupuestos de construcción (España) y formato BC3.\n\nTarea: A partir del contenido BC3 proporcionado, extrae y estructura: 1) Partidas (código, descripción, unidad, precio si aparece). 2) Categorías o capítulos. 3) Variantes base si hay descomposiciones.\n\nResponde en JSON: {\"partidas\": [{\"codigo\": \"\", \"descripcion\": \"\", \"unidad\": \"\", \"precio_unitario\": null}], \"categorias\": [\"nombre\"], \"variantes_base\": [{\"codigo\": \"\", \"nombre\": \"\"}]}\n\nCONTENIDO BC3:\n{{CONTENIDO_BC3}}"
  },
  "crear_partida": {
    "name": "Crear partida desde cero (sin rendimiento)",
    "template": "Eres una IA experta en presupuestos de construcción (España). Devuelve SOLO JSON válido.\n\nOBJETIVO: Crear UNA partida básica desde cero: nombre, descripción técnica breve, unidad, categoría y subcategoría. NO incluyas desglose de recursos ni rendimiento.\n\nFORMATO JSON: {\"codigo\": \"opcional\", \"nombre\": \"Nombre corto\", \"descripcion\": \"Descripción técnica\", \"unidad\": \"m²|m³|ml|ud|h\", \"categoria\": \"ACABADOS|DEMOLICIONES|...\", \"subcategoria\": \"opcional\"}\n\nDESCRIPCIÓN O Petición:\n{{DESCRIPCION}}"
  },
  "generar_recursos": {
    "name": "Sugerir recursos para una variante",
    "template": "Eres una IA experta en presupuestos de construcción (España). Sugiere recursos TÍPICOS para esta partida/variante: maquinaria, equipos, materiales, mano de obra.\n\nPARTIDA: {{CODIGO_PARTIDA}} | {{NOMBRE_PARTIDA}}\nDESCRIPCIÓN: {{DESCRIPCION_PARTIDA}}\nRECURSOS ACTUALES: {{RECURSOS_ACTUALES}}\n\nREGLAS: 4-10 recursos. Tipos: MATERIAL, MANO_OBRA, HERRAMIENTA. Responde SOLO JSON: {\"recursos_sugeridos\":[{\"nombre\":\"\",\"tipo\":\"MATERIAL|MANO_OBRA|HERRAMIENTA\",\"unidad\":\"\",\"rendimiento_sugerido\":0,\"precio_unitario_eur\":0,\"nota\":\"\"}]}"
  },
  "generar_rendimiento": {
    "name": "Estimar rendimiento según tipo de variante",
    "template": "Eres un experto en presupuestos de construcción (España). Estima el RENDIMIENTO (unidades de obra por jornada o hora) para esta variante. Responde JSON: {\"rendimiento\": número, \"unidad_tiempo\": \"jornada\"|\"hora\", \"explicacion_breve\": \"1 línea\"}\n\nDESCRIPCIÓN DE LA VARIANTE:\n{{DESCRIPCION}}"
  },
  "crear_presupuesto": {
    "name": "Crear presupuesto completo",
    "template": "Eres una IA experta en construcción y presupuestos de obra (España). Genera un presupuesto completo con partidas, cantidades, unidades y precios. Responde SOLO JSON válido. Estructura: nombre, cliente, descripcion, partidas[{nombre, descripcion, cantidad, unidad, precioUnitario, subtotal, categoria, nivel}], total, notas. Precios realistas mercado español.\n\nDESCRIPCIÓN DEL PROYECTO:\n{{DESCRIPCION_PROYECTO}}"
  },
  "presupuesto_por_tipo": {
    "name": "Estructura de presupuesto por tipo de obra",
    "template": "Eres una IA experta en construcción y presupuestos (España). Crea el ÍNDICE del presupuesto (partidas + cantidades + unidades), sin precios, para el TIPO DE OBRA. Mínimo 8 partidas. JSON: nombre, descripcion, partidas[{nombre, descripcion, cantidad, unidad, categoria, nivel, codigoNivel, nombreNivel}], notas.\n\nTIPO DE OBRA:\n{{TIPO_OBRA}}"
  },
  "lista_materiales": {
    "name": "Extraer materiales de una variante",
    "template": "Eres un asistente de presupuestos de construcción (España). Extrae SOLO la lista de materiales de la variante/partida. Responde JSON: {\"materiales\": [{\"nombre\": \"\", \"unidad\": \"\", \"cantidad_estimada\": 0}]}\n\nVARIANTE O DESCRIPCIÓN:\n{{DESCRIPCION}}"
  },
  "analisis_pu": {
    "name": "Explicar análisis del precio unitario (sin precios)",
    "template": "Eres un experto en presupuestos de construcción (España). Explica cómo se analiza o descompone el PRECIO UNITARIO de esta partida: qué componentes (materiales, mano de obra, medios), en qué orden. NO des precios; solo metodología. 1-2 párrafos.\n\nPARTIDA O VARIANTE:\n{{DESCRIPCION}}"
  },
  "clasificar_partida": {
    "name": "Asignar categoría y subcategoría a una partida",
    "template": "Eres un clasificador de partidas de construcción (España). Salida ÚNICAMENTE JSON. PARTIDA: {{PARTIDA_BC3}}. CATÁLOGO: {{CATALOGO_ACTUAL}}. Asigna categoría/subcategoría; si duplicado partida_base_id; si no codigo_interno y nivel1-4. Prefijos: DEM, MOV, CIM, EST, CUB, REV, PAV, INS, CAR, PIN, OBR, GEN. Formato: XXX.NN.NN.NNN. Salida: {\"duplicado\": bool, \"partida_base_id\": id|null, \"codigo_interno\": \"\", \"nivel1\"-\"nivel4\": \"\"}"
  },
  "subcategorias_por_categoria": {
    "name": "Crear subcategorías según categoría",
    "template": "Eres un experto en presupuestos de construcción (España). Para la categoría indicada, genera subcategorías típicas. Responde JSON: {\"categoria\": \"\", \"subcategorias\": [\"Sub1\", \"Sub2\"]}\n\nCATEGORÍA:\n{{CATEGORIA}}"
  },
  "generar_mediciones": {
    "name": "Sugerir mediciones típicas según tipo de obra",
    "template": "Eres un experto en mediciones y presupuestos (España). Para el tipo de obra, sugiere mediciones típicas: concepto, unidad, nota. JSON: {\"tipo_obra\": \"\", \"mediciones\": [{\"concepto\": \"\", \"unidad\": \"\", \"nota\": \"\"}]}\n\nTIPO DE OBRA:\n{{TIPO_OBRA}}"
  },
  "mejorar_descripcion": {
    "name": "Mejorar descripción para hacerla profesional",
    "template": "Eres un redactor técnico de presupuestos de construcción (España). Reescribe la descripción para que sea profesional, clara y técnica. Mantén el significado. Responde SOLO la descripción mejorada, máx 400 caracteres.\n\nDESCRIPCIÓN ACTUAL:\n{{TEXTO}}"
  },
  "crear_categorias": {
    "name": "Generar categorías de obra",
    "template": "Eres un experto en presupuestos de construcción (España). Genera categorías típicas de obra para un catálogo (Demoliciones, Movimiento de tierras, Cimentación, Estructura, Cubiertas, Revestimientos, Pavimentos, Instalaciones, etc.). JSON: {\"categorias\": [\"Cat1\", \"Cat2\"]}\n\nCONTEXTO (opcional):\n{{CONTEXTO}}"
  },
  "crear_subpartidas": {
    "name": "Dividir partida en subpartidas o tareas",
    "template": "Eres un experto en presupuestos de construcción (España). Divide la partida en subpartidas o tareas lógicas. JSON: {\"partida_origen\": \"\", \"subpartidas\": [{\"nombre\": \"\", \"descripcion\": \"\", \"unidad\": \"\"}]}\n\nPARTIDA:\n{{DESCRIPCION}}"
  },
  "explicar_partida": {
    "name": "Explicar técnicamente partida o variante",
    "template": "Eres un experto en construcción (España). Explica qué es esta partida o variante: qué trabajo incluye, qué materiales o medios, en qué condiciones. 2-4 frases. Responde SOLO la explicación.\n\nPARTIDA O VARIANTE:\n{{DESCRIPCION}}"
  },
  "variantes_por_categoria": {
    "name": "Generar variantes típicas de una categoría",
    "template": "Eres un experto en presupuestos de construcción (España). Para la categoría indicada, genera variantes típicas (nombre + descripción breve). JSON: {\"categoria\": \"\", \"variantes\": [{\"nombre\": \"\", \"descripcion\": \"\"}]}\n\nCATEGORÍA:\n{{CATEGORIA}}"
  },
  "partidas_por_categoria": {
    "name": "Generar partidas típicas de una categoría",
    "template": "Eres un experto en presupuestos de construcción (España). Para la categoría indicada, genera partidas típicas (nombre + descripción + unidad). JSON: {\"categoria\": \"\", \"partidas\": [{\"nombre\": \"\", \"descripcion\": \"\", \"unidad\": \"m²|m³|ml|ud|h\"}]}\n\nCATEGORÍA:\n{{CATEGORIA}}"
  },
  "limpiar_texto": {
    "name": "Limpiar textos importados (BC3, PDF, OCR)",
    "template": "Eres un asistente para presupuestos de construcción (España). Limpia el texto importado (BC3, PDF, OCR): elimina caracteres raros, unifica espacios, corrige errores de codificación. Devuelve SOLO el texto limpio.\n\nTEXTO:\n{{TEXTO}}"
  }
}
